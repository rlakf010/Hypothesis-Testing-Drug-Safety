# Hypothesis Testing in Healthcare: Drug Safety

## 1. Project Overview
이 프로젝트는 Drug과 Placebo 그룹 간 이상반응 발생 여부, 이상반응 개수, 나이 분포의 차이를
통계적 가설검정을 통해 분석하여 약물의 안전성을 평가하는 것을 목표로 합니다.

import pandas as pd
from scipy.stats import chi2_contingency, mannwhitneyu
from statsmodels.stats.proportion import proportions_ztest

drug_safety = pd.read_csv("data/drug_safety.csv")
drug_safety.head()

## 2. Adverse Effects Proportion Test

- H0 (귀무가설): Drug와 Placebo 그룹의 이상반응 비율은 같다.
- H1 (대립가설): Drug와 Placebo 그룹의 이상반응 비율은 다르다.

이 검정은 두 그룹 간 비율 차이를 비교하기 위해 two-sample proportion z-test를 사용합니다.


adverse_table = pd.crosstab(
    drug_safety["trx"],
    drug_safety["adverse_effects"]
)

count = adverse_table.iloc[:, 1].values
nobs = adverse_table.sum(axis=1).values

_, two_sample_p_value = proportions_ztest(count, nobs)

two_sample_p_value

### Result & Interpretation

p-value = 0.032

유의수준 0.05 기준에서 귀무가설을 기각할 수 있으며,
Drug와 Placebo 그룹 간 이상반응 비율에는 통계적으로 유의한 차이가 존재합니다.
이는 Drug 투여가 이상반응 발생 위험에 영향을 미칠 가능성이 있음을 시사합니다.


## 3. Independence Test: Number of Adverse Effects and Treatment Group

이 검정은 치료 그룹(Drug/Placebo)과 이상반응 개수 간의 독립성을 확인하기 위해
Chi-square test of independence를 사용합니다.

num_effects_table = pd.crosstab(
    drug_safety["trx"],
    drug_safety["num_effects"]
)

_, num_effects_p_value, _, _ = chi2_contingency(num_effects_table)

num_effects_p_value

### Result & Interpretation

p-value가 0.05보다 작다면, 이상반응 개수는 치료 그룹과 독립적이지 않다고 볼 수 있으며,
Drug 투여 여부에 따라 이상반응 개수 분포가 달라질 수 있음을 의미합니다.


## 4. Age Difference Test between Drug and Placebo Groups

연령 분포는 정규성을 가정하기 어려울 수 있으므로,
비모수 검정인 Mann–Whitney U test를 사용하여 두 그룹 간 나이 차이를 비교합니다.

drug_ages = drug_safety.loc[drug_safety["trx"] == "Drug", "age"]
placebo_ages = drug_safety.loc[drug_safety["trx"] == "Placebo", "age"]

_, age_group_effects_p_value = mannwhitneyu(
    drug_ages,
    placebo_ages,
    alternative="two-sided"
)

age_group_effects_p_value

### Result & Interpretation

p-value를 통해 두 그룹 간 나이 분포 차이가 통계적으로 유의한지 판단할 수 있으며,
유의한 차이가 없다면 연령이 결과에 혼란변수(confounder)로 작용하지 않았음을 시사합니다.

